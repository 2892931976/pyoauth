
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyoauth.oauth1.client &mdash; pyoauth v0.0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/minimalism.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="pyoauth v0.0.1 documentation" href="../../../index.html" />
    <link rel="up" title="pyoauth.oauth1" href="../oauth1.html" /> 
  </head>
  <body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pyoauth.oauth1.client</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c"># OAuth 1.0 Client.</span>
<span class="c">#</span>
<span class="c"># Copyright (C) 2011 Yesudeep Mangalapilly &lt;yesudeep@gmail.com&gt;</span>
<span class="c">#</span>
<span class="c"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may</span>
<span class="c"># not use this file except in compliance with the License. You may obtain</span>
<span class="c"># a copy of the License at</span>
<span class="c">#</span>
<span class="c">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c">#</span>
<span class="c"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span>
<span class="c"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span>
<span class="c"># License for the specific language governing permissions and limitations</span>
<span class="c"># under the License.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">:module: pyoauth.oauth1.client</span>
<span class="sd">:synopsis: Implements an OAuth 1.0 client.</span>

<span class="sd">.. autoclass:: Client</span>
<span class="sd">   :members:</span>
<span class="sd">   :show-inheritance:</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">pyoauth.error</span> <span class="kn">import</span> <span class="n">IllegalArgumentError</span><span class="p">,</span> \
    <span class="n">InvalidHttpResponseError</span><span class="p">,</span> \
    <span class="n">HttpError</span><span class="p">,</span> \
    <span class="n">InvalidSignatureMethodError</span><span class="p">,</span> \
    <span class="n">InvalidAuthorizationHeaderError</span><span class="p">,</span> \
    <span class="n">InvalidContentTypeError</span><span class="p">,</span> <span class="n">InvalidHttpRequestError</span>

<span class="kn">from</span> <span class="nn">pyoauth.http</span> <span class="kn">import</span> <span class="n">RequestProxy</span><span class="p">,</span> <span class="n">CONTENT_TYPE_FORM_URLENCODED</span>
<span class="kn">from</span> <span class="nn">pyoauth.oauth1</span> <span class="kn">import</span> \
    <span class="n">Credentials</span><span class="p">,</span> \
    <span class="n">SIGNATURE_METHOD_HMAC_SHA1</span><span class="p">,</span> \
    <span class="n">SIGNATURE_METHOD_RSA_SHA1</span><span class="p">,</span> \
    <span class="n">SIGNATURE_METHOD_PLAINTEXT</span>
<span class="kn">from</span> <span class="nn">pyoauth.url</span> <span class="kn">import</span> \
    <span class="n">oauth_url_sanitize</span><span class="p">,</span> \
    <span class="n">request_protocol_params_sanitize</span><span class="p">,</span> \
    <span class="n">query_params_sanitize</span><span class="p">,</span> \
    <span class="n">url_add_query</span><span class="p">,</span> \
    <span class="n">url_append_query</span><span class="p">,</span> \
    <span class="n">parse_qs</span><span class="p">,</span> <span class="n">query_append</span><span class="p">,</span> <span class="n">is_valid_callback_url</span>
<span class="kn">from</span> <span class="nn">pyoauth.protocol</span> <span class="kn">import</span> <span class="n">generate_nonce</span><span class="p">,</span> \
    <span class="n">generate_timestamp</span><span class="p">,</span> \
    <span class="n">generate_hmac_sha1_signature</span><span class="p">,</span> \
    <span class="n">generate_rsa_sha1_signature</span><span class="p">,</span> \
    <span class="n">generate_plaintext_signature</span><span class="p">,</span> \
    <span class="n">generate_normalized_authorization_header_value</span>


<span class="n">SIGNATURE_METHOD_MAP</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">SIGNATURE_METHOD_HMAC_SHA1</span><span class="p">:</span> <span class="n">generate_hmac_sha1_signature</span><span class="p">,</span>
    <span class="n">SIGNATURE_METHOD_RSA_SHA1</span><span class="p">:</span> <span class="n">generate_rsa_sha1_signature</span><span class="p">,</span>
    <span class="n">SIGNATURE_METHOD_PLAINTEXT</span><span class="p">:</span> <span class="n">generate_plaintext_signature</span><span class="p">,</span>
<span class="p">}</span>


<div class="viewcode-block" id="Client"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client">[docs]</a><span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    OAuth 1.0 Client.</span>

<span class="sd">    :param client_credentials:</span>
<span class="sd">        Client (consumer) credentials.</span>
<span class="sd">    :param temporary_credentials_request_uri:</span>
<span class="sd">        OAuth request token URI.</span>

<span class="sd">        Any query parameters starting with ``oauth_`` will be excluded from</span>
<span class="sd">        the URL. All OAuth parameters must be specified in their respective</span>
<span class="sd">        requests.</span>

<span class="sd">        .. NOTE::</span>
<span class="sd">            Must use SSL/TLS.</span>

<span class="sd">            See http://tools.ietf.org/html/rfc5849#section-2.1</span>
<span class="sd">    :param resource_owner_authorization_uri:</span>
<span class="sd">        OAuth authorization URI.</span>

<span class="sd">        Any query parameters starting with ``oauth_`` will be excluded from</span>
<span class="sd">        the URL. All OAuth parameters must be specified in their respective</span>
<span class="sd">        requests.</span>
<span class="sd">    :param token_request_uri:</span>
<span class="sd">        OAuth access token request URI.</span>

<span class="sd">        Any query parameters starting with ``oauth_`` will be excluded from</span>
<span class="sd">        the URL. All OAuth parameters must be specified in their respective</span>
<span class="sd">        requests.</span>

<span class="sd">        .. NOTE::</span>
<span class="sd">            Must use SSL/TLS.</span>

<span class="sd">            See http://tools.ietf.org/html/rfc5849#section-2.3</span>
<span class="sd">    :param use_authorization_header:</span>
<span class="sd">        ``True`` (default) to use the HTTP Authorization header to pass OAuth</span>
<span class="sd">        parameters; ``False`` will force using the URL query string or</span>
<span class="sd">        the entity-body of a request.</span>

<span class="sd">        Using the HTTP Authorization header is preferable for many reasons</span>
<span class="sd">        including:</span>

<span class="sd">        1. Keeps your server request logs clean and readable.</span>

<span class="sd">        2. Separates any protocol-specific parameters from server or</span>
<span class="sd">           application-specific parameters.</span>

<span class="sd">        3. Debugging OAuth problems is easier.</span>

<span class="sd">        However, not all OAuth servers may support this feature. Therefore,</span>
<span class="sd">        you can set this to ``False`` for use with such services.</span>
<span class="sd">    :param authorization_header_param_delimiter:</span>
<span class="sd">        The delimiter used to separate header value parameters.</span>
<span class="sd">        According to the Specification, this must be a comma ``,``. However,</span>
<span class="sd">        certain services like Yahoo! use ``&amp;`` instead. Comma is default.</span>

<span class="sd">            See https://github.com/oauth/oauth-ruby/pull/12</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">client_credentials</span><span class="p">,</span>
                 <span class="n">temporary_credentials_request_uri</span><span class="p">,</span>
                 <span class="n">token_credentials_request_uri</span><span class="p">,</span>
                 <span class="n">resource_owner_authorization_uri</span><span class="p">,</span>
                 <span class="n">resource_owner_authentication_uri</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">use_authorization_header</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">authorization_header_param_delimiter</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an instance of an OAuth 1.0 client.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client_credentials</span> <span class="o">=</span> <span class="n">client_credentials</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_temporary_credentials_request_uri</span> <span class="o">=</span> \
            <span class="n">oauth_url_sanitize</span><span class="p">(</span><span class="n">temporary_credentials_request_uri</span><span class="p">,</span>
                               <span class="n">force_secure</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_resource_owner_authorization_uri</span> <span class="o">=</span> \
            <span class="n">oauth_url_sanitize</span><span class="p">(</span><span class="n">resource_owner_authorization_uri</span><span class="p">,</span>
                               <span class="n">force_secure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_credentials_request_uri</span> <span class="o">=</span> \
            <span class="n">oauth_url_sanitize</span><span class="p">(</span><span class="n">token_credentials_request_uri</span><span class="p">,</span>
                               <span class="n">force_secure</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource_owner_authentication_uri</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resource_owner_authentication_uri</span> <span class="o">=</span> \
                <span class="n">oauth_url_sanitize</span><span class="p">(</span><span class="n">resource_owner_authentication_uri</span><span class="p">,</span>
                                   <span class="n">force_secure</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_resource_owner_authentication_uri</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_authorization_header</span> <span class="o">=</span> <span class="n">use_authorization_header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_authorization_header_param_delimiter</span> <span class="o">=</span> <span class="n">authorization_header_param_delimiter</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Client.oauth_version"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client.oauth_version">[docs]</a>    <span class="k">def</span> <span class="nf">oauth_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Must return ``&quot;1.0&quot;`` (unless for compatibility, in which case,</span>
<span class="sd">        you are all by yourself.)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&quot;1.0&quot;</span>
</div>
<div class="viewcode-block" id="Client.build_temporary_credentials_request"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client.build_temporary_credentials_request">[docs]</a>    <span class="k">def</span> <span class="nf">build_temporary_credentials_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                            <span class="n">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">,</span>
                                            <span class="n">payload_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                            <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                            <span class="n">realm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                            <span class="n">oauth_signature_method</span><span class="o">=</span><span class="n">SIGNATURE_METHOD_HMAC_SHA1</span><span class="p">,</span>
                                            <span class="n">oauth_callback</span><span class="o">=</span><span class="s">&quot;oob&quot;</span><span class="p">,</span>
                                            <span class="o">**</span><span class="n">extra_oauth_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds an OAuth request for temporary credentials.</span>

<span class="sd">        :param method:</span>
<span class="sd">            HTTP request method. Default POST.</span>
<span class="sd">        :param payload_params:</span>
<span class="sd">            A dictionary of payload parameters. These will be serialized</span>
<span class="sd">            into the URL or the entity-body depending on the HTTP request method.</span>
<span class="sd">            These must not include any parameters starting with ``oauth_``. Any</span>
<span class="sd">            of these parameters with names starting with the ``oauth_`` prefix</span>
<span class="sd">            will be ignored.</span>
<span class="sd">        :param headers:</span>
<span class="sd">            A dictionary of headers that will be passed along with the request.</span>
<span class="sd">            Must not include the &quot;Authorization&quot; header.</span>
<span class="sd">        :param realm:</span>
<span class="sd">            The value to use for the realm parameter in the Authorization HTTP</span>
<span class="sd">            header. It will be excluded from the base string, however.</span>
<span class="sd">        :param oauth_signature_method:</span>
<span class="sd">            One of:</span>
<span class="sd">            1. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_HMAC_SHA1`</span>
<span class="sd">            2. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_RSA_SHA1`</span>
<span class="sd">            3. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_PLAINTEXT`</span>
<span class="sd">        :param oauth_callback:</span>
<span class="sd">            A callback URL that you want the server to call when done</span>
<span class="sd">            with your requests.</span>
<span class="sd">        :param extra_oauth_params:</span>
<span class="sd">            Any additional oauth parameters you would like to include.</span>
<span class="sd">            The parameter names must begin with ``oauth_``. Any other parameters</span>
<span class="sd">            with names that do not begin with this prefix will be ignored.</span>
<span class="sd">        :returns:</span>
<span class="sd">            An instance of :class:`pyoauth.http.RequestProxy`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid_callback_url</span><span class="p">(</span><span class="n">oauth_callback</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;`oauth_callback` parameter value is invalid: `</span><span class="si">%r</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oauth_callback</span><span class="p">,</span> <span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                   <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_temporary_credentials_request_uri</span><span class="p">,</span>
                                   <span class="n">payload_params</span><span class="o">=</span><span class="n">payload_params</span><span class="p">,</span>
                                   <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                   <span class="n">realm</span><span class="o">=</span><span class="n">realm</span><span class="p">,</span>
                                   <span class="n">oauth_signature_method</span><span class="o">=</span><span class="n">oauth_signature_method</span><span class="p">,</span>
                                   <span class="n">oauth_callback</span><span class="o">=</span><span class="n">oauth_callback</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">extra_oauth_params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Client.get_authorization_url"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client.get_authorization_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_authorization_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temporary_credentials</span><span class="p">,</span> <span class="o">**</span><span class="n">query_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the authorization URL to which the user will be (re)directed.</span>

<span class="sd">        :param temporary_credentials:</span>
<span class="sd">            Temporary credentials obtained after parsing the response to</span>
<span class="sd">            the temporary credentials request.</span>
<span class="sd">        :param query_params:</span>
<span class="sd">            Additional query parameters that you would like to include</span>
<span class="sd">            into the authorization URL. Parameters beginning with the ``oauth_``</span>
<span class="sd">            prefix will be ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_owner_authorization_uri</span>
        <span class="k">if</span> <span class="n">query_params</span><span class="p">:</span>
            <span class="n">query_params</span> <span class="o">=</span> <span class="n">query_params_sanitize</span><span class="p">(</span><span class="n">query_params</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">url_append_query</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">query_params</span><span class="p">)</span>
        <span class="c"># So that the &quot;oauth_token&quot; appears LAST.</span>
        <span class="k">return</span> <span class="n">url_append_query</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&quot;oauth_token&quot;</span><span class="p">:</span> <span class="n">temporary_credentials</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span>
        <span class="p">})</span>
</div>
<div class="viewcode-block" id="Client.get_authentication_url"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client.get_authentication_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_authentication_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temporary_credentials</span><span class="p">,</span> <span class="o">**</span><span class="n">query_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the automatic authentication redirect URL to which the</span>
<span class="sd">        user will be (re)directed.</span>

<span class="sd">        :param temporary_credentials:</span>
<span class="sd">            Temporary credentials obtained after parsing the response to</span>
<span class="sd">            the temporary credentials request.</span>
<span class="sd">        :param query_params:</span>
<span class="sd">            Additional query parameters that you would like to include</span>
<span class="sd">            into the authorization URL. Parameters beginning with the ``oauth_``</span>
<span class="sd">            prefix will be ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_owner_authentication_uri</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Service does not support automatic authentication redirects.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query_params</span><span class="p">:</span>
            <span class="n">query_params</span> <span class="o">=</span> <span class="n">query_params_sanitize</span><span class="p">(</span><span class="n">query_params</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">url_append_query</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">query_params</span><span class="p">)</span>
        <span class="c"># So that the &quot;oauth_token&quot; appears LAST.</span>
        <span class="k">return</span> <span class="n">url_append_query</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="p">{</span>
            <span class="s">&quot;oauth_token&quot;</span><span class="p">:</span> <span class="n">temporary_credentials</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span>
        <span class="p">})</span>

</div>
<div class="viewcode-block" id="Client.build_token_credentials_request"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client.build_token_credentials_request">[docs]</a>    <span class="k">def</span> <span class="nf">build_token_credentials_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                        <span class="n">temporary_credentials</span><span class="p">,</span>
                                        <span class="n">oauth_verifier</span><span class="p">,</span>
                                        <span class="n">method</span><span class="o">=</span><span class="s">&quot;POST&quot;</span><span class="p">,</span>
                                        <span class="n">payload_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                        <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                        <span class="n">realm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                        <span class="n">oauth_signature_method</span><span class="o">=</span><span class="n">SIGNATURE_METHOD_HMAC_SHA1</span><span class="p">,</span>
                                        <span class="o">**</span><span class="n">extra_oauth_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds an OAuth request instance for token credentials from the OAuth</span>
<span class="sd">        server.</span>

<span class="sd">        :param temporary_credentials:</span>
<span class="sd">            Temporary credentials obtained from the response to the</span>
<span class="sd">            request built by</span>
<span class="sd">            :func:`Client.build_temporary_credentials_request`.</span>
<span class="sd">        :param oauth_verifier:</span>
<span class="sd">            OAuth verification string sent by the server to your callback URI</span>
<span class="sd">            or input by the user into your application.</span>
<span class="sd">        :param method:</span>
<span class="sd">            The HTTP method to use. Default POST.</span>
<span class="sd">        :param payload_params:</span>
<span class="sd">            A dictionary of payload parameters. These will be serialized</span>
<span class="sd">            into the URL or the entity-body depending on the HTTP request method.</span>
<span class="sd">            These must not include any parameters starting with ``oauth_``. Any</span>
<span class="sd">            of these parameters with names starting with the ``oauth_`` prefix</span>
<span class="sd">            will be ignored.</span>
<span class="sd">        :param headers:</span>
<span class="sd">            A dictionary of headers that will be passed along with the request.</span>
<span class="sd">            Must not include the &quot;Authorization&quot; header.</span>
<span class="sd">        :param realm:</span>
<span class="sd">            The value to use for the realm parameter in the Authorization HTTP</span>
<span class="sd">            header. It will be excluded from the base string, however.</span>
<span class="sd">        :param oauth_signature_method:</span>
<span class="sd">            One of:</span>
<span class="sd">            1. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_HMAC_SHA1`</span>
<span class="sd">            2. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_RSA_SHA1`</span>
<span class="sd">            3. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_PLAINTEXT`</span>
<span class="sd">        :param extra_oauth_params:</span>
<span class="sd">            Any additional oauth parameters you would like to include.</span>
<span class="sd">            The parameter names must begin with ``oauth_``. Any other parameters</span>
<span class="sd">            with names that do not begin with this prefix will be ignored.</span>
<span class="sd">        :returns:</span>
<span class="sd">            An instance of :class:`pyoauth.http.RequestProxy`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&quot;oauth_callback&quot;</span> <span class="ow">in</span> <span class="n">extra_oauth_params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IllegalArgumentError</span><span class="p">(</span><span class="s">&quot;`oauth_callback` is reserved for use with temporary credentials request only.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                   <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_token_credentials_request_uri</span><span class="p">,</span>
                                   <span class="n">payload_params</span><span class="o">=</span><span class="n">payload_params</span><span class="p">,</span>
                                   <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                   <span class="n">token_or_temporary_credentials</span><span class="o">=</span><span class="n">temporary_credentials</span><span class="p">,</span>
                                   <span class="n">realm</span><span class="o">=</span><span class="n">realm</span><span class="p">,</span>
                                   <span class="n">oauth_signature_method</span><span class="o">=</span><span class="n">oauth_signature_method</span><span class="p">,</span>
                                   <span class="n">oauth_verifier</span><span class="o">=</span><span class="n">oauth_verifier</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">extra_oauth_params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Client.build_resource_request"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client.build_resource_request">[docs]</a>    <span class="k">def</span> <span class="nf">build_resource_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">token_credentials</span><span class="p">,</span>
                               <span class="n">method</span><span class="p">,</span>
                               <span class="n">url</span><span class="p">,</span>
                               <span class="n">payload_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                               <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                               <span class="n">realm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                               <span class="n">oauth_signature_method</span><span class="o">=</span><span class="n">SIGNATURE_METHOD_HMAC_SHA1</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">extra_oauth_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds an OAuth request instance for token credentials from the OAuth</span>
<span class="sd">        server.</span>

<span class="sd">        :param token_credentials:</span>
<span class="sd">            Temporary credentials obtained from the response to the</span>
<span class="sd">            request built by</span>
<span class="sd">            :func:`Client.build_temporary_credentials_request`.</span>
<span class="sd">        :param method:</span>
<span class="sd">            The HTTP method to use.</span>
<span class="sd">        :param url:</span>
<span class="sd">            The HTTP URL to which the resource request must be sent.</span>
<span class="sd">        :param payload_params:</span>
<span class="sd">            A dictionary of payload parameters. These will be serialized</span>
<span class="sd">            into the URL or the entity-body depending on the HTTP request method.</span>
<span class="sd">            These must not include any parameters starting with ``oauth_``. Any</span>
<span class="sd">            of these parameters with names starting with the ``oauth_`` prefix</span>
<span class="sd">            will be ignored.</span>
<span class="sd">        :param headers:</span>
<span class="sd">            A dictionary of headers that will be passed along with the request.</span>
<span class="sd">            Must not include the &quot;Authorization&quot; header.</span>
<span class="sd">        :param realm:</span>
<span class="sd">            The value to use for the realm parameter in the Authorization HTTP</span>
<span class="sd">            header. It will be excluded from the base string, however.</span>
<span class="sd">        :param oauth_signature_method:</span>
<span class="sd">            One of:</span>
<span class="sd">            1. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_HMAC_SHA1`</span>
<span class="sd">            2. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_RSA_SHA1`</span>
<span class="sd">            3. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_PLAINTEXT`</span>
<span class="sd">        :param extra_oauth_params:</span>
<span class="sd">            Any additional oauth parameters you would like to include.</span>
<span class="sd">            The parameter names must begin with ``oauth_``. Any other parameters</span>
<span class="sd">            with names that do not begin with this prefix will be ignored.</span>
<span class="sd">        :returns:</span>
<span class="sd">            An instance of :class:`pyoauth.http.RequestProxy`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&quot;oauth_callback&quot;</span> <span class="ow">in</span> <span class="n">extra_oauth_params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">IllegalArgumentError</span><span class="p">(</span><span class="s">&quot;`oauth_callback` is reserved for use with temporary credentials request only.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                                   <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
                                   <span class="n">payload_params</span><span class="o">=</span><span class="n">payload_params</span><span class="p">,</span>
                                   <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                                   <span class="n">realm</span><span class="o">=</span><span class="n">realm</span><span class="p">,</span>
                                   <span class="n">token_or_temporary_credentials</span><span class="o">=</span><span class="n">token_credentials</span><span class="p">,</span>
                                   <span class="n">oauth_signature_method</span><span class="o">=</span><span class="n">oauth_signature_method</span><span class="p">,</span>
                                   <span class="o">**</span><span class="n">extra_oauth_params</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Client.check_verification_code"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client.check_verification_code">[docs]</a>    <span class="k">def</span> <span class="nf">check_verification_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">temporary_credentials</span><span class="p">,</span> <span class="n">oauth_token</span><span class="p">,</span> <span class="n">oauth_verifier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When the OAuth 1.0 server redirects the resource owner to your</span>
<span class="sd">        callback URL, it will attach two parameters to the query string.</span>

<span class="sd">        1. ``oauth_token``: Must match your temporary credentials identifier.</span>
<span class="sd">        2. ``oauth_verifier``: Server-generated verification code that you will</span>
<span class="sd">           use in the next step--that is requesting token credentials.</span>

<span class="sd">        :param temporary_credentials:</span>
<span class="sd">            Temporary credentials</span>
<span class="sd">        :param oauth_token:</span>
<span class="sd">            The value of the ``oauth_token`` parameter as obtained</span>
<span class="sd">            from the server redirect.</span>
<span class="sd">        :param oauth_verifier:</span>
<span class="sd">            The value of the ``oauth_verifier`` parameter as obtained</span>
<span class="sd">            from the server redirect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">temporary_credentials</span><span class="o">.</span><span class="n">identifier</span> <span class="o">!=</span> <span class="n">oauth_token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidHttpRequestError</span><span class="p">(</span><span class="s">&quot;OAuth token returned in callback query `</span><span class="si">%r</span><span class="s">` does not match temporary credentials: `</span><span class="si">%r</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oauth_token</span><span class="p">,</span> <span class="n">temporary_credentials</span><span class="o">.</span><span class="n">identifer</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">oauth_verifier</span>
</div>
<div class="viewcode-block" id="Client.parse_temporary_credentials_response"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client.parse_temporary_credentials_response">[docs]</a>    <span class="k">def</span> <span class="nf">parse_temporary_credentials_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses the entity-body of the OAuth server response to an OAuth</span>
<span class="sd">        temporary credentials request.</span>

<span class="sd">        :param response:</span>
<span class="sd">            An instance of :class:`pyoauth.http.ResponseProxy`.</span>
<span class="sd">        :returns:</span>
<span class="sd">            A tuple of the form::</span>

<span class="sd">                (parameter dictionary, pyoauth.oauth1.Credentials instance)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_credentials_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="n">callback_confirmed</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;oauth_callback_confirmed&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">callback_confirmed</span> <span class="o">!=</span> <span class="s">&quot;true&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Invalid OAuth server response -- `oauth_callback_confirmed` MUST be set to `true`.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">credentials</span>
</div>
<div class="viewcode-block" id="Client.parse_token_credentials_response"><a class="viewcode-back" href="../../../api/oauth1.html#pyoauth.oauth1.client.Client.parse_token_credentials_response">[docs]</a>    <span class="k">def</span> <span class="nf">parse_token_credentials_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses the entity-body of the OAuth server response to an OAuth</span>
<span class="sd">        token credentials request.</span>

<span class="sd">        :param response:</span>
<span class="sd">            An instance of :class:`pyoauth.http.ResponseProxy`.</span>
<span class="sd">        :returns:</span>
<span class="sd">            A tuple of the form::</span>

<span class="sd">                (parameter dictionary, pyoauth.oauth1.Credentials instance)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_credentials_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_parse_credentials_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parses the entity-body of the OAuth server response to an OAuth</span>
<span class="sd">        credential request.</span>

<span class="sd">        :param response:</span>
<span class="sd">            An instance of :class:`pyoauth.http.ResponseProxy`.</span>
<span class="sd">        :returns:</span>
<span class="sd">            A tuple of the form::</span>

<span class="sd">                (parameter dictionary, pyoauth.oauth1.Credentials instance)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidHttpResponseError</span><span class="p">(</span><span class="s">&quot;Invalid status code: `</span><span class="si">%r</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidHttpResponseError</span><span class="p">(</span><span class="s">&quot;Invalid status message: `</span><span class="si">%r</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">payload</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidHttpResponseError</span><span class="p">(</span><span class="s">&quot;Body is invalid or empty: `</span><span class="si">%r</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">payload</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidHttpResponseError</span><span class="p">(</span><span class="s">&quot;Headers are invalid or not specified: `</span><span class="si">%r</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="p">))</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HttpError</span><span class="p">(</span><span class="s">&quot;Could not fetch credentials: HTTP </span><span class="si">%d</span><span class="s"> - </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,))</span>
        <span class="c"># The response body must be URL encoded.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">response</span><span class="o">.</span><span class="n">is_body_form_urlencoded</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">InvalidContentTypeError</span><span class="p">(</span><span class="s">&quot;OAuth credentials server response must have Content-Type: `</span><span class="si">%s</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CONTENT_TYPE_FORM_URLENCODED</span><span class="p">,</span> <span class="p">))</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">Credentials</span><span class="p">(</span><span class="n">identifier</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s">&quot;oauth_token&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">shared_secret</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s">&quot;oauth_token_secret&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_build_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">method</span><span class="p">,</span>
                      <span class="n">url</span><span class="p">,</span>
                      <span class="n">payload_params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">token_or_temporary_credentials</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">realm</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                      <span class="n">oauth_signature_method</span><span class="o">=</span><span class="n">SIGNATURE_METHOD_HMAC_SHA1</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">extra_oauth_params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds an OAuth request.</span>

<span class="sd">        :param method:</span>
<span class="sd">            HTTP request method.</span>
<span class="sd">        :param url:</span>
<span class="sd">            The OAuth request URI.</span>
<span class="sd">        :param payload_params:</span>
<span class="sd">            A dictionary of payload parameters. These will be serialized</span>
<span class="sd">            into the URL or the entity-body depending on the HTTP request method.</span>
<span class="sd">            These must not include any parameters starting with ``oauth_``. Any</span>
<span class="sd">            of these parameters with names starting with the ``oauth_`` prefix</span>
<span class="sd">            will be ignored.</span>
<span class="sd">        :param headers:</span>
<span class="sd">            A dictionary of headers that will be passed along with the request.</span>
<span class="sd">            Must not include the &quot;Authorization&quot; header.</span>
<span class="sd">        :param realm:</span>
<span class="sd">            The value to use for the realm parameter in the Authorization HTTP</span>
<span class="sd">            header. It will be excluded from the request signature.</span>
<span class="sd">        :param oauth_signature_method:</span>
<span class="sd">            One of:</span>
<span class="sd">            1. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_HMAC_SHA1`</span>
<span class="sd">            2. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_RSA_SHA1`</span>
<span class="sd">            3. :attr:`pyoauth.oauth1.SIGNATURE_METHOD_PLAINTEXT`</span>
<span class="sd">        :param extra_oauth_params:</span>
<span class="sd">            Any additional oauth parameters you would like to include.</span>
<span class="sd">            The parameter names must begin with ``oauth_``. Any other parameters</span>
<span class="sd">            with names that do not begin with this prefix will be ignored.</span>
<span class="sd">        :returns:</span>
<span class="sd">            An instance of :class:`pyoauth.http.Request`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">realm</span> <span class="o">=</span> <span class="n">realm</span> <span class="ow">or</span> <span class="s">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">oauth_signature_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SIGNATURE_METHOD_MAP</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidSignatureMethodError</span><span class="p">(</span><span class="s">&quot;Invalid signature method specified: `</span><span class="si">%r</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oauth_signature_method</span><span class="p">,))</span>

        <span class="c"># Required OAuth protocol parameters.</span>
        <span class="c"># See Making Requests (http://tools.ietf.org/html/rfc5849#section-3.1)</span>
        <span class="n">oauth_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">oauth_consumer_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_client_credentials</span><span class="o">.</span><span class="n">identifier</span><span class="p">,</span>
            <span class="n">oauth_signature_method</span><span class="o">=</span><span class="n">oauth_signature_method</span><span class="p">,</span>
            <span class="n">oauth_timestamp</span><span class="o">=</span><span class="n">generate_timestamp</span><span class="p">(),</span>
            <span class="n">oauth_nonce</span><span class="o">=</span><span class="n">generate_nonce</span><span class="p">(),</span>
            <span class="n">oauth_version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth_version</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">token_or_temporary_credentials</span><span class="p">:</span>
            <span class="n">oauth_params</span><span class="p">[</span><span class="s">&quot;oauth_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token_or_temporary_credentials</span><span class="o">.</span><span class="n">identifier</span>

        <span class="k">if</span> <span class="s">&quot;_test_force_exclude_oauth_version&quot;</span> <span class="ow">in</span> <span class="n">extra_oauth_params</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">oauth_params</span><span class="p">[</span><span class="s">&quot;oauth_version&quot;</span><span class="p">]</span>

        <span class="c"># Filter and add additional OAuth parameters.</span>
        <span class="n">_force_override_reserved_oauth_params_for_tests</span> <span class="o">=</span> <span class="s">&quot;_test_force_override_reserved_oauth_params&quot;</span> <span class="ow">in</span> <span class="n">extra_oauth_params</span>
        <span class="n">extra_oauth_params</span> <span class="o">=</span> <span class="n">request_protocol_params_sanitize</span><span class="p">(</span><span class="n">extra_oauth_params</span><span class="p">)</span>
        <span class="n">reserved_oauth_params</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s">&quot;oauth_signature&quot;</span><span class="p">,</span>     <span class="c"># Calculated from given parameters.</span>
            <span class="s">&quot;oauth_nonce&quot;</span><span class="p">,</span>         <span class="c"># System-generated.</span>
            <span class="s">&quot;oauth_timestamp&quot;</span><span class="p">,</span>     <span class="c"># System-generated.</span>
            <span class="s">&quot;oauth_consumer_key&quot;</span><span class="p">,</span>  <span class="c"># Provided when creating the client instance.</span>
            <span class="s">&quot;oauth_version&quot;</span><span class="p">,</span>       <span class="c"># Optional but MUST be set to &quot;1.0&quot; according to spec.</span>
            <span class="s">&quot;oauth_token&quot;</span><span class="p">,</span>         <span class="c"># Determined from the token or temporary credentials.</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">extra_oauth_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_force_override_reserved_oauth_params_for_tests</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">reserved_oauth_params</span><span class="p">:</span>
                <span class="c"># Don&#39;t override these required system-generated protocol parameters.</span>
                <span class="k">raise</span> <span class="n">IllegalArgumentError</span><span class="p">(</span><span class="s">&quot;Cannot override system-generated protocol parameter `</span><span class="si">%r</span><span class="s">`.&quot;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">oauth_params</span><span class="p">:</span>
                    <span class="c"># Warn when an existing protocol parameter is being</span>
                    <span class="c"># overridden.</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&quot;Overriding existing protocol parameter `</span><span class="si">%r</span><span class="s">`=`</span><span class="si">%r</span><span class="s">` with `</span><span class="si">%r</span><span class="s">`=`</span><span class="si">%r</span><span class="s">`&quot;</span><span class="p">,</span>
                                    <span class="n">k</span><span class="p">,</span> <span class="n">oauth_params</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">oauth_params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c"># Filter payload parameters for the request.</span>
        <span class="n">payload_params</span> <span class="o">=</span> <span class="n">query_params_sanitize</span><span class="p">(</span><span class="n">payload_params</span><span class="p">)</span>

        <span class="c"># I was not entirely certain about whether PUT payload</span>
        <span class="c"># params should be included in the signature or not.</span>
        <span class="c"># Here is why:</span>
        <span class="c">#</span>
        <span class="c">#    http://groups.google.com/group/oauth/browse_thread/thread/fdc0b11f2c4a8dc3/</span>
        <span class="c">#</span>
        <span class="c"># http://tools.ietf.org/html/rfc5849#appendix-A</span>
        <span class="c"># However, Appendix A in the RFC specification clarifies this point.</span>
        <span class="c"># form URL encoded entity bodies in a request using any HTTP verb</span>
        <span class="c"># must be part of the base string used for the signature.</span>
        <span class="c"># Therefore, do NOT exclude payload params from the signature URL</span>
        <span class="c"># when the PUT HTTP method is used.</span>
        <span class="c">#</span>
        <span class="c">#if method == &quot;PUT&quot;:</span>
        <span class="c">#     signature_url = url</span>
        <span class="c">#else:</span>
        <span class="n">signature_url</span> <span class="o">=</span> <span class="n">url_add_query</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload_params</span><span class="p">)</span>

        <span class="c"># Determine the request&#39;s OAuth signature.</span>
        <span class="n">oauth_params</span><span class="p">[</span><span class="s">&quot;oauth_signature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sign_request_data</span><span class="p">(</span><span class="n">oauth_signature_method</span><span class="p">,</span>
                                                                  <span class="n">method</span><span class="p">,</span> <span class="n">signature_url</span><span class="p">,</span> <span class="n">oauth_params</span><span class="p">,</span>
                                                                  <span class="n">token_or_temporary_credentials</span><span class="p">)</span>

        <span class="c"># Build request data now.</span>
        <span class="c"># OAuth parameters and any parameters starting with the ``oauth_``</span>
        <span class="c"># must be included only in ONE of these three locations:</span>
        <span class="c">#</span>
        <span class="c"># 1. Authorization header.</span>
        <span class="c"># 2. Request URI query string.</span>
        <span class="c"># 3. Request entity body.</span>
        <span class="c">#</span>
        <span class="c"># See Parameter Transmission (http://tools.ietf.org/html/rfc5849#section-3.6)</span>
        <span class="k">if</span> <span class="s">&quot;Authorization&quot;</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidAuthorizationHeaderError</span><span class="p">(</span><span class="s">&quot;Authorization field is already present in headers: `</span><span class="si">%r</span><span class="s">`&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_authorization_header</span><span class="p">:</span>
            <span class="n">auth_header_value</span> <span class="o">=</span> \
                <span class="n">generate_normalized_authorization_header_value</span><span class="p">(</span><span class="n">oauth_params</span><span class="p">,</span>
                                                          <span class="n">realm</span><span class="o">=</span><span class="n">realm</span><span class="p">,</span>
                                                          <span class="n">param_delimiter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_authorization_header_param_delimiter</span><span class="p">)</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth_header_value</span>
            <span class="c"># Empty the params if using authorization so that they are not</span>
            <span class="c"># included multiple times in a request below.</span>
            <span class="n">oauth_params</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&quot;GET&quot;</span><span class="p">:</span>
            <span class="n">request_url</span> <span class="o">=</span> <span class="n">url_add_query</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">payload_params</span><span class="p">)</span>
            <span class="n">request_url</span> <span class="o">=</span> <span class="n">url_append_query</span><span class="p">(</span><span class="n">request_url</span><span class="p">,</span> <span class="n">oauth_params</span><span class="p">)</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># The payload params are not appended to the OAuth request URL</span>
            <span class="c"># in this case but added to the payload instead.</span>
            <span class="n">request_url</span> <span class="o">=</span> <span class="n">url</span>
            <span class="n">headers</span><span class="p">[</span><span class="s">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONTENT_TYPE_FORM_URLENCODED</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">query_append</span><span class="p">(</span><span class="n">payload_params</span><span class="p">,</span> <span class="n">oauth_params</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">RequestProxy</span><span class="p">(</span><span class="n">method</span><span class="p">,</span>
                            <span class="n">url</span><span class="o">=</span><span class="n">request_url</span><span class="p">,</span>
                            <span class="n">body</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
                            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sign_request_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signature_method</span><span class="p">,</span>
                           <span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">oauth_params</span><span class="p">,</span>
                           <span class="n">credentials</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a signature for the given OAuth request using the credentials</span>
<span class="sd">        and the signature method specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sign_func</span> <span class="o">=</span> <span class="n">SIGNATURE_METHOD_MAP</span><span class="p">[</span><span class="n">signature_method</span><span class="p">]</span>
        <span class="n">credentials_shared_secret</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">shared_secret</span> <span class="k">if</span> <span class="n">credentials</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">sign_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_client_credentials</span><span class="o">.</span><span class="n">shared_secret</span><span class="p">,</span>
                         <span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">oauth_params</span><span class="p">,</span>
                         <span class="n">credentials_shared_secret</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  
<h3>Navigation</h3>
<p>
  <a href="../../../index.html">Documentation overview</a>
</p>
<ul>
    </ul></li>
    </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <a href="http://github.com/gorakhargosh/pyoauth">
      <img
        style="position: absolute; top: 0; right: 0; border: 0;"
        src="https://assets2.github.com/img/71eeaab9d563c2b3c590319b398dd35683265e85?repo=&url=http%3A%2F%2Fs3.amazonaws.com%2Fgithub%2Fribbons%2Fforkme_right_gray_6d6d6d.png&path="
        alt="Fork me on GitHub">
    </a>
  

    <div class="footer">
        &copy; Copyright 2011, Yesudeep Mangalapilly.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>